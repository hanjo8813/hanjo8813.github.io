---
title:  "[ë°ë¸Œì½”ìŠ¤] Spring Rest API"
date: 2021-09-01
categories: 
  - TIL

# ê³ ì •ê°’
classes: wide
toc: false
toc_sticky: false
---

W5D3 Part2 - Rest API ì •ì˜ì™€ Http Message Converterì— ëŒ€í•´ ì•Œì•„ë³´ì!


## Rest API 

- Representational State Transfer
- ê· ì¼í•œ ì¸í„°í˜ì´ìŠ¤

### Richardson Maturity Model

- Restfulí•œ ìˆ˜ì¤€ì— ë“±ê¸‰ì„ ë§¤ê¸´ê²ƒ

![image](https://user-images.githubusercontent.com/71180414/131725089-8c40eb93-d99d-4bb8-93ea-2ab5a8ab6997.png){:style="width:60%"}

- `Level 0` : URL ë§¤í•‘ì„ í†µí•´ xmlì„ ì „ë‹¬í•˜ëŠ” ë°©ì‹ (ë¦¬ì†ŒìŠ¤ê°€ ì—†ìŒ)
- `Level 1` : ë¦¬ì†ŒìŠ¤ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ URLì„ ì„¤ê³„ -> í•˜ë‚˜ì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ ë‹¤ì–‘í•œ íƒ€ì…ì˜ ë°ì´í„°ë¥¼ ì œê³µí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤

<div class="sub_title">Level 1 - ë©”íƒ€ë°ì´í„°ë¥¼ í†µí•´ ë‹¤ì–‘í•œ íƒ€ì…ì„ ì œê³µ</div>

![image](https://user-images.githubusercontent.com/71180414/131725594-24c97f3d-d3ed-4a55-a9f2-28f3b361aa09.png){:style="width:70%"}

- `Level 2` : ëª©ì ì— ë§ëŠ” HTTP Methodë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ. ìì„¸í•œê±´ -> ([ğŸš€ í¬ìŠ¤íŒ… ì´ë™](/til/23/))
- `Level 3` : `HATEOAS`(Hypermedia as the Engine of Application State)ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒ

<div class="sub_title">HATEOAS : ë¦¬ì†ŒìŠ¤ë¥¼ í†µí•´ ì»¨íŠ¸ë¡¤ ê°€ëŠ¥í•œ í–‰ìœ„ë¥¼ ì œê³µí•œë‹¤.</div>

```json
{
    "id": "1",
    "contents": "ê³µë¶€í•©ì‹œë‹¤.",
    "createAt": "2020-01-01 12:00:00",
    "likes": 2,
    "likesOfMe": false,
    "comments": [],
    "writer": { "id": "2", "email": "harry@gmail.com", "name": "harry" },
    "links": [
        {"rel": "self", "action": "GET", "href": "/api/v1/posts/1"},
        {"rel": "deletePost", "action": "DELETE", "href": "/api/v1/posts/1" },
        {"rel": "getWriter", "action": "GET", "href": "/api/v1/users/1" },
        {"rel": "addComment", "action": "POST", "href": "/api/v1/posts/1/comments"}
    ]
}
```

### API ì„¤ê³„

1. URLì€ ì •ë³´ì˜ ìì›ì„ í‘œí˜„í•œë‹¤. (ë™ì‚¬X ëª…ì‚¬O)
1. ìì›ì— ëŒ€í•œ í–‰ìœ„ëŠ” HTTP Methodë¡œ í‘œí˜„
1. `/`ëŠ” ê³„ì¸µ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤ (ë™ì‚¬í‘œí˜„ì€ ìì› ë’¤ë¡œ)
1. URL ë§ˆì§€ë§‰ì— `/`ë¥¼ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤
1. URI ê°€ë…ì„±ì„ ìœ„í•´ì„  `-`ì„ ì‚¬ìš© (`_` ì‚¬ìš©ì€ ì§€ì–‘)

<br>

## Http Message Converter

![image](https://user-images.githubusercontent.com/71180414/131729800-fc57caed-9da6-43a1-ba5a-12504ee07e9d.png){:style="width:70%; margin-top:15px;"}

- í•˜ë‚˜ì˜ ë©”ì‹œì§€ ì»¨ë²„í„°ê°€ ìš”ì²­, ì‘ë‹µì˜ ë°ì´í„° ë³€í™˜ì„ ëª¨ë‘ ë§¡ëŠ”ë‹¤
- `Contents Type`ì„ í†µí•´ ë©”ì‹œì§€ ì»¨ë²„í„°ì˜ ë™ì‘ ì—¬ë¶€ë¥¼ ì •í•œë‹¤!

### ì˜ì¡´ì„± ì„¤ì •

- `pom.xml` ì˜ì¡´ì„± ì¶”ê°€

```xml
<!-- Spring oxm -->
<dependency>
	<groupId>org.springframework</groupId>
	<artifactId>spring-oxm</artifactId>
</dependency>

<!-- xstream -->
<dependency>
	<groupId>com.thoughtworks.xstream</groupId>
	<artifactId>xstream</artifactId>
	<version>1.4.17</version>
</dependency>
```

### Converter ë³€ê²½

- ì»¨ë²„í„°ì˜ default í˜•ì‹ì€ jsonì´ì§€ë§Œ servlet app contextì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆìŒ 
- `configureMessageConverters` ë©”ì†Œë“œë¥¼ Servlet App Context Config í´ë˜ìŠ¤ì— ë“±ë¡í•˜ê³  ë‚´ë¶€ë¥¼ êµ¬í˜„í•˜ë©´ë¨
- í•˜ì§€ë§Œ ì´ëŠ” ê¸°ë³¸ ì»¨ë²„í„°ë¥¼ ëª¨ë‘ ë®ì–´ì”Œì›Œë²„ë¦°ë‹¤.

```java
@Override
public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {
    var messageConverter = new MarshallingHttpMessageConverter();
    var xStreamMarshaller = new XStreamMarshaller();
    // java -> xml
    messageConverter.setMarshaller(xStreamMarshaller);
    // xml -> java
    messageConverter.setUnmarshaller(xStreamMarshaller);
    // ê¸°ì¡´ ì»¨ë²„í„°ì— ì„¤ì •í•œê±° ì¶”ê°€
    converters.add(messageConverter);
}
```

### Converter ì¶”ê°€, ì‹œê°„í˜•ì‹ ë³€ê²½

- ì»¨ë²„í„°ë¥¼ ë®ì–´ì”Œìš°ì§€ ì•Šê³  ì¶”ê°€í•˜ë ¤ë©´ `extendMessageConverters` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
- ë˜ jsonìœ¼ë¡œ ì¶œë ¥ë˜ëŠ” í˜•ì‹ë„ ë³€ê²½ì´ ê°€ëŠ¥í•˜ë‹¤.
    - ì•„ë˜ëŠ” ì‹œê°„ ì¶œë ¥í˜•ì‹ì„ ë³€ê²½í•˜ëŠ” ì˜ˆì œ

<div class="sub_title">ë˜‘ê°™ì´ Configì— ë“±ë¡</div>

```java
@Override
public void extendMessageConverters(List<HttpMessageConverter<?>> converters) {
    ...ìœ„ì™€ë™ì¼...
    // ì¶”ê°€ ì»¨ë²„í„°ë¥¼ ìš°ì„ ìˆœìœ„ 0ìœ¼ë¡œ ì¶”ê°€
    converters.add(0, messageConverter);

    // json ì‹œê°„ ì¶œë ¥í˜•ì‹ ë³€ê²½
    var javaTimeModule = new JavaTimeModule();
    javaTimeModule.addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormattISO_DATE_TIME));
    var modules = Jackson2ObjectMapperBuilder.json().modules(javaTimeModule);
    converters.add(1, new MappingJackson2HttpMessageConverter(modules.build()));
}
```

- json í˜•ì‹ ë³€ê²½í•  ë•Œ `Jackson2ObjectMapper`ì„ ì£¼ë¡œ ì“´ë‹¤ê³  í•¨

<br>


## Intellijë¡œ Rest API í…ŒìŠ¤íŠ¸í•˜ê¸°

- Intellijì—ì„œ Postmanì²˜ëŸ¼ API í…ŒìŠ¤íŠ¸ íˆ´ì„ ì œê³µí•œë‹¤ (~~ì—†ëŠ”ê²Œ ë­ì•¼?~~)
    - But í…ŒìŠ¤íŠ¸ ì–‘ì´ ë§ì•„ì§€ë©´ Postmanì„ ì‚¬ìš©í•˜ì!

<div class="sub_title">ì»¨íŠ¸ë¡¤ëŸ¬ ì˜†ì— ì €ê±° ëˆŒëŸ¬ì£¼ë©´</div>

![image](https://user-images.githubusercontent.com/71180414/131736386-5eda6539-1d39-4ce6-a7fb-b0218e4761cc.png){:style="width:50%;"}

<div class="sub_title">ìš”ë ‡ê²Œ API ìš”ì²­ì„ ë³´ë‚¼ìˆ˜ ìˆë‹¤</div>

![image](https://user-images.githubusercontent.com/71180414/131736313-a24b6ce8-49c2-4419-852e-c305a4468ed1.png){:style="width:50%;"}

- `Accept` : APIê°€ ë°›ëŠ” ë°ì´í„° íƒ€ì…
- `Content-Type` : APIê°€ ë³´ë‚´ëŠ” ë°ì´í„° íƒ€ì…